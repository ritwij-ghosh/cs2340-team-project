{% extends 'base.html' %}
{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-md-8">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <div>
              <h1 class="h3 mb-1">{{ job.title }}</h1>
              <h2 class="h5 text-primary mb-0">{{ job.company }}</h2>
            </div>
            {% if user == job.recruiter %}
              <div class="btn-group" role="group">
                <a href="{% url 'jobs:edit_job' job.pk %}" class="btn btn-outline-primary btn-sm">
                  <i class="fas fa-edit me-1"></i>Edit
                </a>
                <a href="{% url 'jobs:delete_job' job.pk %}" class="btn btn-outline-danger btn-sm">
                  <i class="fas fa-trash me-1"></i>Delete
                </a>
              </div>
            {% endif %}
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <p class="mb-1">
                <i class="fas fa-map-marker-alt text-muted me-2"></i>
                <strong>Location:</strong> {{ job.location }}
              </p>
              <p class="mb-1">
                <i class="fas fa-clock text-muted me-2"></i>
                <strong>Employment Type:</strong> {{ job.get_employment_type_display }}
              </p>
              <p class="mb-1">
                <i class="fas fa-user-graduate text-muted me-2"></i>
                <strong>Experience Level:</strong> {{ job.get_experience_level_display }}
              </p>
              <p class="mb-1">
                <i class="fas fa-laptop text-muted me-2"></i>
                <strong>Work Type:</strong> {{ job.get_work_type_display }}
              </p>
              {% if job.visa_sponsorship %}
                <p class="mb-1">
                  <i class="fas fa-passport text-muted me-2"></i>
                  <strong>Visa Sponsorship:</strong> Available
                </p>
              {% endif %}
            </div>
            <div class="col-md-6">
              {% if job.has_salary_range %}
                <p class="mb-1">
                  <i class="fas fa-dollar-sign text-muted me-2"></i>
                  <strong>Salary:</strong> {{ job.get_salary_display }}
                </p>
              {% endif %}
              {% if job.application_deadline %}
                <p class="mb-1">
                  <i class="fas fa-calendar-alt text-muted me-2"></i>
                  <strong>Deadline:</strong> {{ job.application_deadline|date:"M d, Y" }}
                </p>
              {% endif %}
              <p class="mb-1">
                <i class="fas fa-calendar-plus text-muted me-2"></i>
                <strong>Posted:</strong> {{ job.created_at|date:"M d, Y" }}
              </p>
            </div>
          </div>

          <hr>

          <div class="mb-4">
            <h4>Job Description</h4>
            <div class="text-muted">
              {{ job.description|linebreaks }}
            </div>
          </div>

          <div class="mb-4">
            <h4>Requirements</h4>
            <div class="text-muted">
              {{ job.requirements|linebreaks }}
            </div>
          </div>

          {% if job.get_skills_list %}
            <div class="mb-4">
              <h4>Required Skills</h4>
              <div class="mb-2">
                {% for skill in job.get_skills_list %}
                  <span class="badge bg-primary me-1 mb-1">{{ skill }}</span>
                {% endfor %}
              </div>
            </div>
          {% endif %}

          {% if job.benefits %}
            <div class="mb-4">
              <h4>Benefits</h4>
              <div class="text-muted">
                {{ job.benefits|linebreaks }}
              </div>
            </div>
          {% endif %}

          <div class="d-flex gap-2 mt-4">
            {% if user.is_authenticated and user != job.recruiter %}
              {% if job.external_url %}
                <a href="{{ job.external_url }}" target="_blank" class="btn btn-outline-primary">
                  <i class="fas fa-external-link-alt me-1"></i>External Apply
                </a>
              {% endif %}
              <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#quickApplyModal">
                <i class="fas fa-paper-plane me-1"></i>Quick Apply
              </button>
            {% elif job.external_url %}
              <a href="{{ job.external_url }}" target="_blank" class="btn btn-primary">
                <i class="fas fa-external-link-alt me-1"></i>Apply Now
              </a>
            {% else %}
              <button class="btn btn-primary" disabled>
                <i class="fas fa-paper-plane me-1"></i>Apply (Coming Soon)
              </button>
            {% endif %}
            <a href="{% url 'jobs:index' %}" class="btn btn-outline-secondary">
              <i class="fas fa-arrow-left me-1"></i>Back to Jobs
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">About this Role</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <strong>Status:</strong>
            <span class="badge {% if job.status == 'active' %}bg-success{% elif job.status == 'paused' %}bg-warning{% else %}bg-secondary{% endif %}">
              {{ job.get_status_display }}
            </span>
          </div>

          {% if job.recruiter %}
            <div class="mb-3">
              <strong>Posted by:</strong><br>
              <small class="text-muted">{{ job.recruiter.get_full_name|default:job.recruiter.username }}</small>
            </div>
          {% endif %}

          <div class="text-muted small">
            <p><strong>Last updated:</strong> {{ job.updated_at|date:"M d, Y g:i A" }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Apply Modal -->
  {% if user.is_authenticated and user != job.recruiter %}
  <div class="modal fade" id="quickApplyModal" tabindex="-1" aria-labelledby="quickApplyModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="quickApplyModalLabel">Quick Apply</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="post" action="{% url 'applications:quick_apply' %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <h6 class="text-primary">{{ job.title }}</h6>
              <p class="text-muted mb-3">{{ job.company }}</p>
            </div>
            <input type="hidden" name="job_title" value="{{ job.title }}">
            <input type="hidden" name="company_name" value="{{ job.company }}">
            <div class="mb-3">
              <label for="note" class="form-label">Personalized Note (optional)</label>
              <textarea id="note" name="note" class="form-control" rows="4" placeholder="Add a short note to personalize your application..."></textarea>
              <small class="form-text text-muted">This note will be included with your application to help you stand out.</small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-paper-plane me-1"></i>Apply Now
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock content %}