{% extends 'base.html' %}
{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1 text-light">My Applications</h2>
      <p class="text-muted mb-0">Track where each opportunity sits in the hiring pipeline.</p>
    </div>
    <a class="btn btn-primary" href="{% url 'applications:create' %}">
      <i class="fas fa-plus me-1"></i>New Application
    </a>
  </div>

  {% if application_forms %}
    <div class="row g-3">
      {% for application, status_form in application_forms %}
        <div class="col-12">
          <div class="card bg-dark border-secondary profile-card">
            <div class="card-body text-light">
              <div class="d-flex justify-content-between flex-wrap gap-3">
                <div>
                  <h4 class="mb-1 text-light">{{ application.job_title }}</h4>
                  <p class="text-muted mb-0">{{ application.company_name }}</p>
                  <small class="text-muted">Applied {{ application.applied_on|date:"M d, Y" }} | Updated {{ application.updated_at|timesince }} ago</small>
                </div>
                <div class="text-end">
                  <span class="text-light fs-5 fw-semibold">{{ application.get_status_display }}</span>
                </div>
              </div>

              <div class="mt-3">
                <div class="progress" style="height: 12px;">
                  <div class="progress-bar bg-info" role="progressbar" style="width: {{ application.progress_percentage }}%;" aria-valuenow="{{ application.progress_percentage }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="d-flex justify-content-between mt-2 flex-wrap gap-3">
                  {% for value, label in status_steps %}
                    {% if application.status == value %}
                      <span class="text-light fs-5 fw-semibold">{{ label }}</span>
                    {% else %}
                      <span class="text-light fs-5">{{ label }}</span>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>

              {% if application.notes %}
                <div class="mt-3">
                  <h6 class="text-primary">Notes</h6>
                  <p class="mb-0 text-light">{{ application.notes|linebreaks }}</p>
                </div>
              {% endif %}

              <form method="post" action="{% url 'applications:update_status' application.id %}" class="mt-3 d-flex flex-wrap gap-2 align-items-center">
                {% csrf_token %}
                <div class="position-relative">
                  {{ status_form.status }}
                  <i class="fas fa-chevron-down position-absolute" style="right: 0.75rem; top: 50%; transform: translateY(-50%); pointer-events: none;"></i>
                </div>
                <button type="submit" class="btn btn-outline-info btn-sm">
                  <i class="fas fa-sync-alt me-1"></i>Update Status
                </button>
              </form>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center py-5">
      <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
      <h4 class="text-light">No applications yet</h4>
      <p class="text-muted">Start tracking your job search by adding the first opportunity.</p>
      <a class="btn btn-primary" href="{% url 'applications:create' %}">
        <i class="fas fa-plus me-1"></i>Add Application
      </a>
    </div>
  {% endif %}
</div>
{% endblock content %}
